'use strict';

var engine      = require('base/client/view').ownerDocument.engine
  , forceReflow = require('base/client/tpl/helpers/force-reflow')

  , build, dom, heading, container, close, box, pClose;

build = engine.build.bind(engine);

close = function () {
	dom.style.display = 'none';
};

build(function () {
	dom = div({ 'class': 'overlay' },
		box = div({ 'class': 'overlay-box' },
			div({ 'class': 'overlay-wrap' },
				heading = header("")(),
				container = div({ 'class': 'content' }, "")()),
			pClose = p({ 'class': 'link-close' },
				a({ onclick: close }))())())();
});

dom.style.display = 'none';
document.body.appendChild(dom);

exports = module.exports = function (h, c, options) {
	if (!c) {
		c = h; h = null;
	}
	if (h) {
		heading.replaceChild(h, heading.firstChild);
		container.classList.remove('no-head');
		heading.style.display = '';
	} else {
		heading.style.display = 'none';
		container.classList.add('no-head');
	}
	pClose.style.display = (options && options.noCancel) ? 'none' : '';
	container.replaceChild(c, container.firstChild);
	dom.style.display = '';
	forceReflow();
	if ((document.body.scrollTop > 220) ||
		(document.documentElement.scrollTop > 220)) {
		scroll(0, 0);
	}
};

exports.close = close;
