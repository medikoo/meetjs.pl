'use strict';

var  emap     = require('base/client/view').ownerDocument.engine.map
  , _         = require('base/i18n')
  , size      = require('base/client/tpl/helpers/readable-size')

module.exports = (function(file, cancelButton) {
	cancelButton = cancelButton || false;
	var self = this, result = {}
	result.progress = {}
	
	result.container = this.div({ 'class': 'preloader' },
		this.table({ 'summary': 'Data Preloader' },
			this.tbody(
				this.tr(
					this.th({ 'class': 'label' }, _("Loading")),
					this.td({ 'class': 'info-filename' }, file.name),
					this.td({ 'class': 'data-left' }, this.span({ 'class': 'value' }, 
						result.progress.amount = this._text(size(file.size))
					)),
					this.td({ 'class': 'progress' }, this.span({ 'class': 'progress-bar progress-animate' },
						result.progress.bar = this.span(this.span(_("Progress")))
					)),
					(cancelButton ? (function(){
						return self.td({ 'class': 'link' },
							self.p({ 'class': 'link-bttn-h' }, result.progress.cancel = self.a(_("Cancel")))
						)
					})() : null)
				)
			)
		)
	)
	result.setProgress = function(value)	{
		result.progress.bar().style.width = value+"%";
	}
	return result;
}).bind(emap);
