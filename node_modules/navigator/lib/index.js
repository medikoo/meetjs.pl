'use strict';

var create   = Object.create
  , toArray  = require('es5-ext/lib/List/to-array').call
  , clone    = require('location/lib/clone')
  , ee       = require('event-emitter')

  , navigator;

navigator = ee({
	update: function () {
		if (this.current.pathname !== location.pathname) {
			this.current = clone(location);
			this.emit('update', location.pathname, location.search, location.hash);
			this.emit(location.pathname, location.search, location.hash);
		} else if ((this.current.search !== location.search) ||
			(this.current.hash !== location.hash)) {
			this.current = clone(location);
			this.emit(location.pathname, location.search, location.hash);
		} else {
			return;
		}
	},
	load: function (url) {
		history.pushState({}, '', url);
		this.update();
	}
});

module.exports = function (window) {
	var o;
	o = create(navigator);
	o.load = o.load.bind(o);
	o.current = clone(location);
	o.update = o.update.bind(o);
	window.addEventListener('popstate', o.update, false);
	return o;
};
