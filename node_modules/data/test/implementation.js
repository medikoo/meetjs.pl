'use strict';

var copy = require('es5-ext/lib/Object/plain/clone').call;

module.exports = function (t, a) {
	var imp, id1, id2, ns1, ns2, o, tmp;
	imp = t(new Date);
	a.deep(Object.keys(imp), [], "Implementation: No objects");

	id1 = imp.generateId();
	id2 = imp.generateId();
	a(typeof id1, "string", "ID is string");
	a.not(id1, id2, "Ids differ");

	ns1 = imp.create('test', {});
	a(ns1.id, 'test', "Namespace: id");
	a.deep(ns1.foreigns, {}, "Namespace: No foreigns");
	a.deep(ns1.relations, {}, "Namespace: No relations");
	a.deep(ns1.implementation, imp, "Namespace: Implementation");
	a.deep(Object.keys(ns1), [], "Namespace: No objects");

	ns2 = imp.create('other', { foo: { type: ns1 } });
	a.deep(ns2.foreigns, { foo: ns1 }, "Namespace: with foreigns");
	tmp= {}, tmp[ns2.id] = ns1.relations[ns2.id];
	a.deep(ns1.relations, tmp, "Namespace: new relations");

	o = ns1.create({});
	a(imp[o._id], o, "Implementation: object");
	tmp = {}; tmp[o._id] = o;
	a.deep(copy(imp), tmp, "Implementation: Objects");

	o._destroy();
	a.deep(copy(imp), {}, "Implementation: Object destroyed");


	a.throws(function () {
		imp.create('test');
	}, "Create with same name");
};